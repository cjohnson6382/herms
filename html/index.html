<head></head
<body>
<!-- the redirect needs to point the user to the index page (or the gmail page that the user is on?) -->
    <a href="https://cjohnson.ignorelist.com:4343/auth">Authenticate with the Googles!</a>
    <br />
    <button type='button' id="listfiles" onclick=apiCall("https://cjohnson.ignorelist.com:4343/listfiles")>list some files</button>
    <br />
    <button type='button' id="createfolder" onclick=apiCall("https://cjohnson.ignorelist.com:4343/createfolder")>make a new folder on drive</button>
    <br />
    <button type='button' id="uploadfile" onclick=uploadFile()>upload a file</button>
    <br />
    <div id="emptyspace"></div>

<script>
    function uploadFile () {
            element = document.getElementById('emptyspace');
            element.on('dragover', function(event){ 
                var evt = document.createEvent('HTMLEvents');
                evt.initEvent('drop', false, true);
                document.dispatchEvent(evt);
                event.stopPropagation();
                event.preventDefault();
                event.dataTransfer.dropEffect = 'copy';
            });
            element.on('drop', function(event){
                event.stopPropagation();
                event.preventDefault();
                files = event.dataTransfer.files;
            });

            var formData = FormData();
            formData.append('file', files[0]);
            formData.append('name', files[0].namej);
            formData.append('length', files[0].size);
            formData.append('type', files[0].type);            

            var xhr = new XMLHttpRequest();
            xhr.open('POST', 'https://cjohnson.ignorelist.com:4343/uploadfile');
            xhr.onload(function ()  {
                if (xhr.status === 200) {
                    console.log(xhr.status);
                    document.getElementById('emptyspace').innerHTML = (xhr.responseText);
                } else {
                    console.log('ERROR', xhr.status);
                }
            })

            xhr.send(formData);
    }

    //  need to modify the apiCall function so that it can send parameters to the nodeJS backend
    //      need to modify the backend so that it can read the parameters and upload the file
    function apiCall(endpoint, parameters) {
        var xhr = new XMLHttpRequest();
        
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                document.getElementById('emptyspace').innerHTML = xhr.responseText;
            }
        };
        
        xhr.open('GET', endpoint, true);
        xhr.send();
    }
</script>
